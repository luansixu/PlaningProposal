<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Deal with the Devi（魔鬼契约 原型 v0.1）</title>
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <div id="page">
      <!-- 16:9 游戏边界：所有 UI 必须在此容器内 -->
      <div id="game-container" aria-label="game-container">
        <canvas id="game-canvas"></canvas>

        <!-- UI 层（DOM 覆盖层，严格相对 #game-container 定位） -->
        <div id="ui-layer" aria-label="ui-layer">
          <!-- 顶部资源条 -->
          <div id="topbar">
            <div class="chip">
              <span class="k">金币</span><span id="stat-gold" class="v">0</span>
            </div>
            <div class="chip">
              <span class="k">幸福</span><span id="stat-happiness" class="v">0</span>
            </div>
            <div class="chip">
              <span class="k">灵魂</span><span id="stat-soul" class="v">0</span>
            </div>
            <div class="chip subtle">
              <span class="k">回合</span><span id="stat-round" class="v">1</span>
            </div>
            <div class="spacer"></div>
            <div class="chip subtle">
              <span class="k">渲染</span><span id="hud-render-mode" class="v">-</span>
            </div>
            <div class="chip subtle">
              <span class="k">THREE</span><span id="hud-three-rev" class="v">-</span>
            </div>
          </div>

          <!-- 屏幕主体：左/中/右三列 -->
          <div id="screen">
            <aside id="left-panel" class="panel">
              <div class="panel-title">能力 / 诅咒</div>
              <div id="list-abilities" class="list placeholder">（原型占位：本回合不发放能力）</div>
              <div class="panel-sep"></div>
              <div id="list-curses" class="list placeholder">（原型占位：诅咒将在结算时展示）</div>
            </aside>

            <main id="center-panel" class="panel">
              <!-- 菜单页 -->
              <section id="view-menu" class="view">
                <div class="title">魔鬼契约</div>
                <div class="subtitle">1 回合可通关最小闭环（LLM 负责契约/谈判/事件 JSON）</div>
                <div class="menu-actions">
                  <button id="btn-start" class="btn primary">开始人生</button>
                  <button id="btn-achievements" class="btn">成就</button>
                  <button id="btn-upgrade" class="btn disabled" disabled>升级（开发中）</button>
                </div>
                <div class="menu-tip">
                  提示：本原型使用“复制提示词 → 在任意大模型生成 JSON → 粘贴回游戏”的方式闭环，避免 API Key 与 CORS 问题。
                </div>
              </section>

              <!-- 局内页 -->
              <section id="view-game" class="view hidden">
                <div class="card">
                  <div class="card-head">
                    <div class="card-title">契约摘要</div>
                    <div id="contract-warning" class="badge hidden">本契约含“致命定义条款”，建议阅读全文。</div>
                  </div>
                  <div id="contract-summary" class="card-body placeholder">（尚未生成契约）</div>
                </div>

                <div class="actions">
                  <button id="btn-generate-offer" class="btn primary">生成契约</button>
                  <button id="btn-fulltext" class="btn" disabled>查看全文</button>
                  <button id="btn-negotiate" class="btn" disabled>谈判（剩余 <span id="neg-left">2</span>）</button>
                  <button id="btn-relic" class="btn" disabled>法宝</button>
                  <div class="spacer"></div>
                  <button id="btn-accept" class="btn good" disabled>接受</button>
                  <button id="btn-reject" class="btn danger" disabled>拒绝</button>
                </div>

                <div class="log">
                  <div class="panel-title">系统提示</div>
                  <div id="system-log" class="log-body">点击“生成契约”开始。</div>
                </div>
              </section>

              <!-- 结算页 -->
              <section id="view-result" class="view hidden">
                <div id="result-title" class="title">结算</div>
                <div id="result-desc" class="subtitle"></div>
                <div class="menu-actions">
                  <button id="btn-back-menu" class="btn primary">返回主菜单</button>
                </div>
              </section>
            </main>

            <aside id="right-panel" class="panel">
              <div class="panel-title">历史契约</div>
              <div id="history" class="list placeholder">（原型：最多 1 条）</div>
              <div class="panel-sep"></div>
              <div class="panel-title">LLM 工作台</div>
              <div class="small">
                提示词已写入底层：游戏会自动调用大模型生成 JSON，并在失败时自动重试/修复/降级模板（仍可通关）。
              </div>
              <button id="btn-llm-workbench" class="btn small-btn">模型设置</button>
            </aside>
          </div>
        </div>

        <!-- 通用弹窗容器（必须在 #game-container 内） -->
        <div id="modal-root" aria-label="modal-root"></div>
      </div>
    </div>

    <!-- 按规则：先 config.js，再 vendor(three)，再业务脚本（禁止 ES6 Modules） -->
    <script src="js/config.js"></script>
    <script src="vendor/three/three.min.js"></script>

    <script src="js/utils.js"></script>
    <script src="js/logger.js"></script>
    <script src="js/debugOverlay.js"></script>

    <script src="js/input.js"></script>
    <script src="js/loader.js"></script>

    <script src="js/llm.js"></script>
    <script src="js/localSecrets.js"></script>
    <script src="js/llmClient.js"></script>
    <script src="js/validate.js"></script>
    <script src="js/templates.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/main.js"></script>
  </body>
</html>
