---
description: 触发式规则：当用户提到【策划案生成】时，把创意转成可执行的纯 Web 原型策划方案
alwaysApply: true
---

# 触发式规则：【策划案生成】→ 可执行策划方案（纯 Web 原型）

## 触发条件（必须遵守）

- **只有当用户在对话中明确出现**：`【策划案生成】` 时，才进入本规则的“策划案生成流程”。
- 若用户未触发该关键词：本规则不主动输出完整策划案（可继续头脑风暴/补充点子）。

## 目标与硬约束（必须遵守）

- **输出目标**：把“输入的创意点子/玩法灵感”转写成**可直接开工实现**的“简单玩法原型策划方案”（偏 MVP），内容足够指导 0→1 制作。
- **技术选型**：**纯 Web**（浏览器可运行）。默认优先最省事的实现方式；不做原生/引擎依赖。
- **API Key 强约束**：严格要求用户提供**可用的**大模型 API Key（及对应 Provider/模型名/接口基址）。
  - **未提供或不可用时**：必须先停下，向用户索取/校验信息；不得用“假 key / 占位 key”继续做可运行方案。
- **美术素材约束**：使用**简单的拼装集合体**作为基础美术素材（几何形状/图标/色块/简单 2D 贴片/基础 UI 组件）；不依赖复杂美术生产。
- **策划案复杂度**：保持简单清晰，只做 1 个核心循环（最多 1 个辅助循环），以最快效率做出可玩的原型。
- **LLM 必须是玩法核心**：遵守本项目底层规则 `llm-core-gameplay.mdc`（大模型不可贴皮，必须改变游戏状态并形成可验收闭环）。

## 策划案生成流程（执行顺序）

### 0) 先收集“最低必要信息”（缺什么问什么）

当触发【策划案生成】时，先检查用户是否提供以下信息：

- **必须项（缺一不可）**  
  - Provider（如 OpenAI/Anthropic/Google/本地兼容 OpenAI）  
  - **可用 API Key**  
  - API Base（若非默认）  
  - Model 名称（如 `gpt-4.1-mini` 等）  
  - 预算/速率偏好（低成本/低延迟/质量优先 三选一）

- **建议项（缺失可做默认假设，但要写明假设）**  
  - 游戏类型偏好（解谜/叙事/roguelike/经营/派对等）  
  - 目标平台（桌面/手机优先）与操作方式（鼠标/触屏）  
  - 期望核心体验关键词（如“推理/欺骗/构筑/协作”）

若必须项缺失：用最短问题清单向用户索取。**拿到 Key 前，不输出“可运行原型方案”的具体接入细节**（可以先输出不含密钥的结构与占位配置步骤，但必须明确“未完成、等待 key”）。

### 1) 从创意点子中选定 1 个“核心循环”

- 若用户给了多个点子：选择**最容易用 Web + LLM 快速落地**且“移除 LLM 就玩不起来”的那个作为核心循环，并说明选择理由（1-2 句）。
- 核心循环必须用一句话概括，并拆成 5~7 步闭环：  
  **输入 → LLM → 解析/约束 → 状态变化 → 反馈 → 结算/推进 →（回到输入）**

### 2) 设计 LLM 的“可解析输出契约”

- 必须给出 **结构化输出格式**（JSON/标签化），包含：
  - `intent` / `action`（玩家意图类别）
  - `params`（关键参数）
  - `explain`（给玩家看的短解释，长度限制）
  - `safety`/`validations`（可选：触发了哪些约束）
- 规定：字段类型、枚举范围、长度限制、失败时的降级输出。

### 3) 玩法系统最小集合（MVP）

- **状态变量**：列出 6~12 个以内的核心状态（数值/布尔/枚举）。
- **资源与风险**：至少 1 个资源（体力/时间/回合/信用等）+ 1 个失败条件。
- **内容生成最小化**：内容用模板化/变量化生成，避免手工堆量。

### 4) 纯 Web 原型实现方案（最快路径）

- 默认实现建议：
  - **前端**：HTML/CSS/JS（或 TS）+ 最少依赖；UI 用组件化但不过度工程化。
  - **网络**：直接调用 Provider SDK 或 `fetch` 调接口；Key 只放本地 `.env`/运行时输入（避免写入仓库）。
  - **素材**：几何形状 + 简单图标 + 色板 + 基础音效（可选）。
- 明确：页面结构、主要组件、数据流、缓存/重试策略、错误提示。

### 5) 验收用例（必须≥5 条）

每条用例包含：玩家输入、期望 LLM JSON 输出要点、期望状态变化、失败时兜底行为。  
必须证明两点：
- **玩家能用策略性输入影响结果**（非纯随机）  
- **移除 LLM 核心循环不可用**（或胜负无法判定/内容无法生成）

### 6) 交付物格式（最终输出模板）

当生成策划案时，必须按以下 Markdown 结构输出（标题可微调但章节必须齐全）：

- **一句话概念**
- **核心卖点（3 条）**
- **核心循环（5~7 步）**
- **LLM 交互设计**
  - 玩家输入形态（文本/选项+文本/多轮）
  - 系统提示词（可直接用）
  - 结构化输出 JSON 契约（schema + 示例）
  - 解析/约束/降级策略
- **游戏状态与数值（≤12 个变量）**
- **UI/页面草图（文字版）**
- **素材方案（拼装集合体规则：形状/色板/图标表）**
- **技术实现与目录结构（纯 Web）**
  - 关键模块与函数职责
  - API Key 接入方式（不把 key 写进仓库）
- **验收用例（≥5）**
- **1 天内最小里程碑（按小时拆分也可）**

## 安全与保密（强制）

- **任何时候都不要让用户把 API Key 写进代码块并提交到 git**。若用户粘贴了 key：提醒只用于本地环境变量/运行时输入，并建议后续轮次以 `sk-***` 形式脱敏展示。
- 输出中可给 `.env.example` 占位，但不得包含真实密钥。

